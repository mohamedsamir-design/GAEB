<app-header 
  [pageTitle]="'Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù…Ø¨Ù†Ù‰ ØªØ¹Ù„ÙŠÙ…ÙŠ'"
  [showBackButton]="true"
  [showHomeButton]="true"
  (backClicked)="navigateBack()"
  (homeClicked)="goHome()"
  (logoutClicked)="logout()"
></app-header>

<div class="container">
  <div class="page-content">
    <!-- Search Mode -->
    @if (viewMode() === 'search') {
      <h1>Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù…Ø¨Ù†Ù‰ ØªØ¹Ù„ÙŠÙ…ÙŠ</h1>
      <p class="subtitle">Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</p>

      <div class="form-wrapper">
        <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
          <div class="form-row">
            <div class="form-group">
              <label for="buildingNumber">Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰</label>
              <input 
                type="text" 
                id="buildingNumber" 
                formControlName="buildingNumber"
                placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰"
              />
            </div>

            <div class="form-group">
              <label for="schoolName">Ø¨Ø­Ø« Ø¹Ø§Ù…</label>
              <input 
                type="text" 
                id="schoolName" 
                formControlName="schoolName"
                placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø±Ù‚Ù… Ø£Ùˆ Ø§Ù„Ø´Ø§Ø±Ø¹"
              />
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">
              <span>ğŸ”</span>
              Ø¨Ø­Ø«
            </button>
            <button type="button" class="btn btn-success" (click)="onCreateNew()">
              <span>â•</span>
              Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ù†Ù‰ Ø¬Ø¯ÙŠØ¯
            </button>
          </div>
        </form>
      </div>
    }

    <!-- View Mode -->
    @if (viewMode() === 'view' && selectedBuilding()) {
      <h1>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</h1>
      
      <div class="building-card">
        <div class="card-header">
          <h2>Ù…Ø¨Ù†Ù‰ Ø±Ù‚Ù…: {{ selectedBuilding()?.buildingNumber }}</h2>
        </div>

        <div class="card-content">
          <div class="info-section">
            <h3>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
            <div class="info-row">
              <div class="info-item">
                <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰:</label>
                <span>{{ selectedBuilding()?.buildingNumber }}</span>
              </div>
              <div class="info-item">
                <label>Ù…ÙˆÙ‚Ù Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</label>
                <span>{{ selectedBuilding()?.usageStatus }}</span>
              </div>
              <div class="info-item">
                <label>Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†:</label>
                <span>{{ selectedBuilding()?.phoneNumber }}</span>
              </div>
            </div>
          </div>

          <div class="info-section">
            <h3>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</h3>
            <div class="info-row">
              <div class="info-item">
                <label>Ø±Ù‚Ù…:</label>
                <span>{{ selectedBuilding()?.addressNumber }}</span>
              </div>
              <div class="info-item">
                <label>Ø´Ø§Ø±Ø¹:</label>
                <span>{{ selectedBuilding()?.street }}</span>
              </div>
            </div>
          </div>

          <div class="info-section">
            <h3>Ø§Ù„Ù…Ù„ÙƒÙŠØ©</h3>
            <div class="info-row">
              <div class="info-item">
                <label>Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø£Ø±Ø¶:</label>
                <span>{{ selectedBuilding()?.landOwnership }}</span>
              </div>
              <div class="info-item">
                <label>Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ù…Ø¨Ù†Ù‰:</label>
                <span>{{ selectedBuilding()?.buildingOwnership }}</span>
              </div>
            </div>
          </div>

          <div class="info-section">
            <h3>Ø§Ù„Ø£Ø³ÙˆØ§Ø±</h3>
            <div class="info-row">
              <div class="info-item">
                <label>ÙƒÙˆØ¯ Ø§Ù„Ø³ÙˆØ±:</label>
                <span>{{ selectedBuilding()?.fenceCode }}</span>
              </div>
              <div class="info-item">
                <label>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹:</label>
                <span>{{ selectedBuilding()?.fenceHeight }} Ù…ØªØ±</span>
              </div>
              <div class="info-item">
                <label>Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙˆØ±:</label>
                <span>{{ selectedBuilding()?.fenceCondition }}</span>
              </div>
              <div class="info-item">
                <label>Ø§Ù„Ø­Ø§Ù„Ø©:</label>
                <span>{{ selectedBuilding()?.buildingMaterial }}</span>
              </div>
            </div>

            <h4>Ø§Ù„Ø£Ø¶Ù„Ø§Ø¹</h4>
            <div class="info-row">
              <div class="info-item">
                <label>Ø´Ù…Ø§Ù„:</label>
                <span>{{ selectedBuilding()?.northSide }} Ù…ØªØ±</span>
              </div>
              <div class="info-item">
                <label>Ø¬Ù†ÙˆØ¨:</label>
                <span>{{ selectedBuilding()?.southSide }} Ù…ØªØ±</span>
              </div>
              <div class="info-item">
                <label>Ø´Ø±Ù‚:</label>
                <span>{{ selectedBuilding()?.eastSide }} Ù…ØªØ±</span>
              </div>
              <div class="info-item">
                <label>ØºØ±Ø¨:</label>
                <span>{{ selectedBuilding()?.westSide }} Ù…ØªØ±</span>
              </div>
            </div>
            <div class="info-row">
              <div class="info-item">
                <label>Ø´Ù…Ø§Ù„ Ø´Ø±Ù‚:</label>
                <span>{{ selectedBuilding()?.northEast }} Ù…ØªØ±</span>
              </div>
              <div class="info-item">
                <label>Ø¬Ù†ÙˆØ¨ Ø´Ø±Ù‚:</label>
                <span>{{ selectedBuilding()?.southEast }} Ù…ØªØ±</span>
              </div>
              <div class="info-item">
                <label>Ø´Ù…Ø§Ù„ ØºØ±Ø¨:</label>
                <span>{{ selectedBuilding()?.northWest }} Ù…ØªØ±</span>
              </div>
              <div class="info-item">
                <label>Ø¬Ù†ÙˆØ¨ ØºØ±Ø¨:</label>
                <span>{{ selectedBuilding()?.southWest }} Ù…ØªØ±</span>
              </div>
            </div>
          </div>

          <div class="info-section">
            <h3>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</h3>
            <div class="info-row">
              <div class="info-item">
                <label>X:</label>
                <span>{{ selectedBuilding()?.coordinateX }}</span>
              </div>
              <div class="info-item">
                <label>Y:</label>
                <span>{{ selectedBuilding()?.coordinateY }}</span>
              </div>
              <div class="info-item">
                <label>Z:</label>
                <span>{{ selectedBuilding()?.coordinateZ }}</span>
              </div>
            </div>
          </div>

          <div class="info-section">
            <h3>Ù…Ø­ÙŠØ·Ø§Øª Ù…Ø¤Ø«Ø±Ø©</h3>
            <div class="info-row">
              <div class="info-item">
                <label>Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ:</label>
                <span>{{ selectedBuilding()?.positiveEnvironment }}</span>
              </div>
              <div class="info-item">
                <label>Ø§Ù„Ø³Ù„Ø¨ÙŠ:</label>
                <span>{{ selectedBuilding()?.negativeEnvironment }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-primary" (click)="onEdit()">
          <span>âœï¸</span>
          ØªØ¹Ø¯ÙŠÙ„
        </button>
        <button type="button" class="btn btn-secondary" (click)="onBackToSearch()">
          <span>ğŸ”™</span>
          Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¨Ø­Ø«
        </button>
      </div>
    }

    <!-- Create/Edit Mode -->
    @if (viewMode() === 'create' || viewMode() === 'edit') {
      <h1>{{ viewMode() === 'create' ? 'Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ù†Ù‰ ØªØ¹Ù„ÙŠÙ…ÙŠ Ø¬Ø¯ÙŠØ¯' : 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ù†Ù‰' }}</h1>

      <!-- Form Validation Summary -->
      @if (buildingForm.invalid && buildingForm.touched) {
        <div class="alert alert-error">
          <strong>âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªØ§Ù„ÙŠØ©:</strong>
          <ul>
            @if (buildingForm.get('buildingNumber')?.invalid && buildingForm.get('buildingNumber')?.touched) {
              <li>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†ÙŠ Ù…Ø·Ù„ÙˆØ¨</li>
            }
            @if (buildingForm.get('usageStatus')?.invalid && buildingForm.get('usageStatus')?.touched) {
              <li>Ù…ÙˆÙ‚Ù Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø·Ù„ÙˆØ¨</li>
            }
            @if (buildingForm.get('phoneNumber')?.invalid && buildingForm.get('phoneNumber')?.touched) {
              <li>Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ† Ù…Ø·Ù„ÙˆØ¨</li>
            }
            @if (buildingForm.get('addressNumber')?.invalid && buildingForm.get('addressNumber')?.touched) {
              <li>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø·Ù„ÙˆØ¨</li>
            }
            @if (buildingForm.get('street')?.invalid && buildingForm.get('street')?.touched) {
              <li>Ø§Ù„Ø´Ø§Ø±Ø¹ Ù…Ø·Ù„ÙˆØ¨</li>
            }
            @if (buildingForm.get('landOwnership')?.invalid && buildingForm.get('landOwnership')?.touched) {
              <li>Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø£Ø±Ø¶ Ù…Ø·Ù„ÙˆØ¨Ø©</li>
            }
            @if (buildingForm.get('buildingOwnership')?.invalid && buildingForm.get('buildingOwnership')?.touched) {
              <li>Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ù…Ø¨Ù†ÙŠ Ù…Ø·Ù„ÙˆØ¨Ø©</li>
            }
            @if (buildingForm.get('fenceCode')?.invalid && buildingForm.get('fenceCode')?.touched) {
              <li>ÙƒÙˆØ¯ Ø§Ù„Ø³ÙˆØ± Ù…Ø·Ù„ÙˆØ¨</li>
            }
            @if (buildingForm.get('fenceHeight')?.invalid && buildingForm.get('fenceHeight')?.touched) {
              <li>Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø³ÙˆØ± Ù…Ø·Ù„ÙˆØ¨</li>
            }
            @if (buildingForm.get('fenceCondition')?.invalid && buildingForm.get('fenceCondition')?.touched) {
              <li>Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙˆØ± Ù…Ø·Ù„ÙˆØ¨Ø©</li>
            }
            @if (buildingForm.get('buildingMaterial')?.invalid && buildingForm.get('buildingMaterial')?.touched) {
              <li>Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø·Ù„ÙˆØ¨Ø©</li>
            }
            @if (buildingForm.get('positiveEnvironment')?.invalid && buildingForm.get('positiveEnvironment')?.touched) {
              <li>Ø§Ù„Ù…Ø­ÙŠØ· Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ù…Ø·Ù„ÙˆØ¨</li>
            }
            @if (buildingForm.get('negativeEnvironment')?.invalid && buildingForm.get('negativeEnvironment')?.touched) {
              <li>Ø§Ù„Ù…Ø­ÙŠØ· Ø§Ù„Ø³Ù„Ø¨ÙŠ Ù…Ø·Ù„ÙˆØ¨</li>
            }
          </ul>
        </div>
      }

      <div class="form-wrapper">
        <form [formGroup]="buildingForm" (ngSubmit)="onSave()">
          
          <!-- Basic Information Section -->
          <div class="form-section">
            <h2 class="section-title">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2>
            <div class="form-row">
              <div class="form-group">
                <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†ÙŠ <span class="required">*</span></label>
                <input 
                  type="text" 
                  formControlName="buildingNumber"
                  [class.error]="buildingForm.get('buildingNumber')?.invalid && buildingForm.get('buildingNumber')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†ÙŠ"
                />
                @if (buildingForm.get('buildingNumber')?.invalid && buildingForm.get('buildingNumber')?.touched) {
                  @if (buildingForm.get('buildingNumber')?.hasError('required')) {
                    <span class="error-message">Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†ÙŠ Ù…Ø·Ù„ÙˆØ¨</span>
                  }
                  @if (buildingForm.get('buildingNumber')?.hasError('maxlength')) {
                    <span class="error-message">Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 50 Ø­Ø±Ù</span>
                  }
                }
              </div>

              <div class="form-group">
                <label>Ù…ÙˆÙ‚Ù Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… <span class="required">*</span></label>
                <input 
                  type="text" 
                  formControlName="usageStatus"
                  [class.error]="buildingForm.get('usageStatus')?.invalid && buildingForm.get('usageStatus')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙˆÙ‚Ù Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…"
                />
                @if (buildingForm.get('usageStatus')?.invalid && buildingForm.get('usageStatus')?.touched) {
                  <span class="error-message">Ù…ÙˆÙ‚Ù Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label>Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ† <span class="required">*</span></label>
                <input 
                  type="tel" 
                  formControlName="phoneNumber"
                  [class.error]="buildingForm.get('phoneNumber')?.invalid && buildingForm.get('phoneNumber')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†"
                />
                @if (buildingForm.get('phoneNumber')?.invalid && buildingForm.get('phoneNumber')?.touched) {
                  <span class="error-message">Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ† Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>
            </div>
          </div>

          <!-- Address Section -->
          <div class="form-section">
            <h2 class="section-title">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</h2>
            <div class="form-row">
              <div class="form-group">
                <label>Ø±Ù‚Ù… <span class="required">*</span></label>
                <input 
                  type="text" 
                  formControlName="addressNumber"
                  [class.error]="buildingForm.get('addressNumber')?.invalid && buildingForm.get('addressNumber')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"
                />
                @if (buildingForm.get('addressNumber')?.invalid && buildingForm.get('addressNumber')?.touched) {
                  <span class="error-message">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label>Ø´Ø§Ø±Ø¹ <span class="required">*</span></label>
                <input 
                  type="text" 
                  formControlName="street"
                  [class.error]="buildingForm.get('street')?.invalid && buildingForm.get('street')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹"
                />
                @if (buildingForm.get('street')?.invalid && buildingForm.get('street')?.touched) {
                  <span class="error-message">Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹ Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>
            </div>
          </div>

          <!-- Ownership Section -->
          <div class="form-section">
            <h2 class="section-title">Ø§Ù„Ù…Ù„ÙƒÙŠØ©</h2>
            <div class="form-row">
              <div class="form-group">
                <label>Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø£Ø±Ø¶ <span class="required">*</span></label>
                <input 
                  type="text" 
                  formControlName="landOwnership"
                  [class.error]="buildingForm.get('landOwnership')?.invalid && buildingForm.get('landOwnership')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø£Ø±Ø¶"
                />
                @if (buildingForm.get('landOwnership')?.invalid && buildingForm.get('landOwnership')?.touched) {
                  <span class="error-message">Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø£Ø±Ø¶ Ù…Ø·Ù„ÙˆØ¨Ø©</span>
                }
              </div>

              <div class="form-group">
                <label>Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ù…Ø¨Ù†ÙŠ <span class="required">*</span></label>
                <input 
                  type="text" 
                  formControlName="buildingOwnership"
                  [class.error]="buildingForm.get('buildingOwnership')?.invalid && buildingForm.get('buildingOwnership')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ù…Ø¨Ù†ÙŠ"
                />
                @if (buildingForm.get('buildingOwnership')?.invalid && buildingForm.get('buildingOwnership')?.touched) {
                  <span class="error-message">Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ù…Ø¨Ù†ÙŠ Ù…Ø·Ù„ÙˆØ¨Ø©</span>
                }
              </div>
            </div>
          </div>

          <!-- Fence Section -->
          <div class="form-section">
            <h2 class="section-title">Ø§Ù„Ø£Ø³ÙˆØ§Ø±</h2>
            <div class="form-row">
              <div class="form-group">
                <label>ÙƒÙˆØ¯ Ø§Ù„Ø³ÙˆØ± <span class="required">*</span></label>
                <input 
                  type="text" 
                  formControlName="fenceCode"
                  [class.error]="buildingForm.get('fenceCode')?.invalid && buildingForm.get('fenceCode')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø³ÙˆØ±"
                />
                @if (buildingForm.get('fenceCode')?.invalid && buildingForm.get('fenceCode')?.touched) {
                  <span class="error-message">ÙƒÙˆØ¯ Ø§Ù„Ø³ÙˆØ± Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ <span class="required">*</span></label>
                <input 
                  type="number" 
                  formControlName="fenceHeight"
                  [class.error]="buildingForm.get('fenceHeight')?.invalid && buildingForm.get('fenceHeight')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ (Ù…ØªØ±)"
                />
                @if (buildingForm.get('fenceHeight')?.invalid && buildingForm.get('fenceHeight')?.touched) {
                  <span class="error-message">Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label>Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙˆØ± <span class="required">*</span></label>
                <input 
                  type="text" 
                  formControlName="fenceCondition"
                  [class.error]="buildingForm.get('fenceCondition')?.invalid && buildingForm.get('fenceCondition')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙˆØ±"
                />
                @if (buildingForm.get('fenceCondition')?.invalid && buildingForm.get('fenceCondition')?.touched) {
                  <span class="error-message">Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙˆØ± Ù…Ø·Ù„ÙˆØ¨Ø©</span>
                }
              </div>

              <div class="form-group">
                <label>Ø§Ù„Ø­Ø§Ù„Ø© <span class="required">*</span></label>
                <input 
                  type="text" 
                  formControlName="buildingMaterial"
                  [class.error]="buildingForm.get('buildingMaterial')?.invalid && buildingForm.get('buildingMaterial')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø­Ø§Ù„Ø©"
                />
                @if (buildingForm.get('buildingMaterial')?.invalid && buildingForm.get('buildingMaterial')?.touched) {
                  <span class="error-message">Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø·Ù„ÙˆØ¨Ø©</span>
                }
              </div>
            </div>

            <h3 class="subsection-title">Ø§Ù„Ø£Ø¶Ù„Ø§Ø¹</h3>
            <div class="form-row">
              <div class="form-group">
                <label>Ø¶Ù„Ø¹ Ø´Ù…Ø§Ù„ <span class="required">*</span></label>
                <input 
                  type="number" 
                  formControlName="northSide"
                  [class.error]="buildingForm.get('northSide')?.invalid && buildingForm.get('northSide')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø·ÙˆÙ„ Ø§Ù„Ø¶Ù„Ø¹ (Ù…ØªØ±)"
                />
                @if (buildingForm.get('northSide')?.invalid && buildingForm.get('northSide')?.touched) {
                  <span class="error-message">Ø¶Ù„Ø¹ Ø´Ù…Ø§Ù„ Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label>Ø¶Ù„Ø¹ Ø¬Ù†ÙˆØ¨ <span class="required">*</span></label>
                <input 
                  type="number" 
                  formControlName="southSide"
                  [class.error]="buildingForm.get('southSide')?.invalid && buildingForm.get('southSide')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø·ÙˆÙ„ Ø§Ù„Ø¶Ù„Ø¹ (Ù…ØªØ±)"
                />
                @if (buildingForm.get('southSide')?.invalid && buildingForm.get('southSide')?.touched) {
                  <span class="error-message">Ø¶Ù„Ø¹ Ø¬Ù†ÙˆØ¨ Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label>Ø¶Ù„Ø¹ Ø´Ø±Ù‚ <span class="required">*</span></label>
                <input 
                  type="number" 
                  formControlName="eastSide"
                  [class.error]="buildingForm.get('eastSide')?.invalid && buildingForm.get('eastSide')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø·ÙˆÙ„ Ø§Ù„Ø¶Ù„Ø¹ (Ù…ØªØ±)"
                />
                @if (buildingForm.get('eastSide')?.invalid && buildingForm.get('eastSide')?.touched) {
                  <span class="error-message">Ø¶Ù„Ø¹ Ø´Ø±Ù‚ Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label>Ø¶Ù„Ø¹ ØºØ±Ø¨ <span class="required">*</span></label>
                <input 
                  type="number" 
                  formControlName="westSide"
                  [class.error]="buildingForm.get('westSide')?.invalid && buildingForm.get('westSide')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø·ÙˆÙ„ Ø§Ù„Ø¶Ù„Ø¹ (Ù…ØªØ±)"
                />
                @if (buildingForm.get('westSide')?.invalid && buildingForm.get('westSide')?.touched) {
                  <span class="error-message">Ø¶Ù„Ø¹ ØºØ±Ø¨ Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label>Ø´Ù…Ø§Ù„ Ø´Ø±Ù‚ <span class="required">*</span></label>
                <input 
                  type="number" 
                  formControlName="northEast"
                  [class.error]="buildingForm.get('northEast')?.invalid && buildingForm.get('northEast')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø·ÙˆÙ„ Ø§Ù„Ø¶Ù„Ø¹ (Ù…ØªØ±)"
                />
                @if (buildingForm.get('northEast')?.invalid && buildingForm.get('northEast')?.touched) {
                  <span class="error-message">Ø´Ù…Ø§Ù„ Ø´Ø±Ù‚ Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label>Ø¬Ù†ÙˆØ¨ Ø´Ø±Ù‚ <span class="required">*</span></label>
                <input 
                  type="number" 
                  formControlName="southEast"
                  [class.error]="buildingForm.get('southEast')?.invalid && buildingForm.get('southEast')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø·ÙˆÙ„ Ø§Ù„Ø¶Ù„Ø¹ (Ù…ØªØ±)"
                />
                @if (buildingForm.get('southEast')?.invalid && buildingForm.get('southEast')?.touched) {
                  <span class="error-message">Ø¬Ù†ÙˆØ¨ Ø´Ø±Ù‚ Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label>Ø´Ù…Ø§Ù„ ØºØ±Ø¨ <span class="required">*</span></label>
                <input 
                  type="number" 
                  formControlName="northWest"
                  [class.error]="buildingForm.get('northWest')?.invalid && buildingForm.get('northWest')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø·ÙˆÙ„ Ø§Ù„Ø¶Ù„Ø¹ (Ù…ØªØ±)"
                />
                @if (buildingForm.get('northWest')?.invalid && buildingForm.get('northWest')?.touched) {
                  <span class="error-message">Ø´Ù…Ø§Ù„ ØºØ±Ø¨ Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label>Ø¬Ù†ÙˆØ¨ ØºØ±Ø¨ <span class="required">*</span></label>
                <input 
                  type="number" 
                  formControlName="southWest"
                  [class.error]="buildingForm.get('southWest')?.invalid && buildingForm.get('southWest')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø·ÙˆÙ„ Ø§Ù„Ø¶Ù„Ø¹ (Ù…ØªØ±)"
                />
                @if (buildingForm.get('southWest')?.invalid && buildingForm.get('southWest')?.touched) {
                  <span class="error-message">Ø¬Ù†ÙˆØ¨ ØºØ±Ø¨ Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>
            </div>
          </div>

          <!-- Coordinates Section -->
          <div class="form-section">
            <h2 class="section-title">Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</h2>
            <div class="form-row">
              <div class="form-group">
                <label>X <span class="required">*</span></label>
                <input 
                  type="number" 
                  step="any"
                  formControlName="coordinateX"
                  [class.error]="buildingForm.get('coordinateX')?.invalid && buildingForm.get('coordinateX')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø¥Ø­Ø¯Ø§Ø«ÙŠ X"
                />
                @if (buildingForm.get('coordinateX')?.invalid && buildingForm.get('coordinateX')?.touched) {
                  <span class="error-message">Ø¥Ø­Ø¯Ø§Ø«ÙŠ X Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label>Y <span class="required">*</span></label>
                <input 
                  type="number" 
                  step="any"
                  formControlName="coordinateY"
                  [class.error]="buildingForm.get('coordinateY')?.invalid && buildingForm.get('coordinateY')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø¥Ø­Ø¯Ø§Ø«ÙŠ Y"
                />
                @if (buildingForm.get('coordinateY')?.invalid && buildingForm.get('coordinateY')?.touched) {
                  <span class="error-message">Ø¥Ø­Ø¯Ø§Ø«ÙŠ Y Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label>Z <span class="required">*</span></label>
                <input 
                  type="number" 
                  step="any"
                  formControlName="coordinateZ"
                  [class.error]="buildingForm.get('coordinateZ')?.invalid && buildingForm.get('coordinateZ')?.touched"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø¥Ø­Ø¯Ø§Ø«ÙŠ Z"
                />
                @if (buildingForm.get('coordinateZ')?.invalid && buildingForm.get('coordinateZ')?.touched) {
                  <span class="error-message">Ø¥Ø­Ø¯Ø§Ø«ÙŠ Z Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>
            </div>
          </div>

          <!-- Environmental Impact Section -->
          <div class="form-section">
            <h2 class="section-title">Ù…Ø­ÙŠØ·Ø§Øª Ù…Ø¤Ø«Ø±Ø©</h2>
            <div class="form-row">
              <div class="form-group">
                <label>Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ <span class="required">*</span></label>
                <select 
                  formControlName="positiveEnvironment"
                  [class.error]="buildingForm.get('positiveEnvironment')?.invalid && buildingForm.get('positiveEnvironment')?.touched"
                >
                  <option value="">-- Ø§Ø®ØªØ± --</option>
                  @for (env of positiveEnvironments; track env.code) {
                    <option [value]="env.name">{{ env.name }}</option>
                  }
                </select>
                @if (buildingForm.get('positiveEnvironment')?.invalid && buildingForm.get('positiveEnvironment')?.touched) {
                  <span class="error-message">Ø§Ù„Ù…Ø­ÙŠØ· Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label>Ø§Ù„Ø³Ù„Ø¨ÙŠ <span class="required">*</span></label>
                <select 
                  formControlName="negativeEnvironment"
                  [class.error]="buildingForm.get('negativeEnvironment')?.invalid && buildingForm.get('negativeEnvironment')?.touched"
                >
                  <option value="">-- Ø§Ø®ØªØ± --</option>
                  @for (env of negativeEnvironments; track env.code) {
                    <option [value]="env.name">{{ env.name }}</option>
                  }
                </select>
                @if (buildingForm.get('negativeEnvironment')?.invalid && buildingForm.get('negativeEnvironment')?.touched) {
                  <span class="error-message">Ø§Ù„Ù…Ø­ÙŠØ· Ø§Ù„Ø³Ù„Ø¨ÙŠ Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">
              <span>ğŸ’¾</span>
              {{ viewMode() === 'create' ? 'Ø­ÙØ¸' : 'ØªØ­Ø¯ÙŠØ«' }}
            </button>
            <button type="button" class="btn btn-secondary" (click)="onCancel()">
              <span>âœ–ï¸</span>
              Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>
        </form>
      </div>
    }
  </div>
</div>

<!-- Search Results Modal -->
@if (showModal()) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</h2>
        <button class="modal-close" (click)="closeModal()">Ã—</button>
      </div>

      <div class="modal-body">
        @if (searchResults().length > 0) {
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰</th>
                  <th>Ù…ÙˆÙ‚Ù Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</th>
                  <th>Ø§Ù„Ø´Ø§Ø±Ø¹</th>
                  <th>Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ù…Ø¨Ù†Ù‰</th>
                  <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                </tr>
              </thead>
              <tbody>
                @for (building of searchResults(); track building.id) {
                  <tr>
                    <td>{{ $index + 1 }}</td>
                    <td>{{ building.buildingNumber }}</td>
                    <td>{{ building.usageStatus }}</td>
                    <td>{{ building.street }}</td>
                    <td>{{ building.buildingOwnership }}</td>
                    <td>
                      <button class="btn btn-sm btn-primary" (click)="onSelectBuilding(building)">
                        Ø¹Ø±Ø¶
                      </button>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        } @else {
          <div class="empty-state">
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>
          </div>
        }
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>
}
