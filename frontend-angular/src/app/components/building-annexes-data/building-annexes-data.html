<app-header 
  [pageTitle]="'ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ø§Ø­Ù‚'"
  [showBackButton]="true"
  [showHomeButton]="true"
  (backClicked)="navigateBack()"
  (homeClicked)="goHome()"
  (logoutClicked)="logout()"
></app-header>

<div class="container">
  <div class="page-content">
    <h1>ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ø§Ø­Ù‚ Ù„Ù„Ù…Ø¨Ù†Ù‰</h1>
    <p class="subtitle">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†ÙŠ Ù„Ù„Ø¨Ø¯Ø¡</p>

    <!-- Building Number Search -->
    <div class="search-section">
      <form [formGroup]="buildingNumberForm">
        <div class="form-group">
          <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†ÙŠ <span class="required">*</span></label>
          <div class="search-input-wrapper">
            <input 
              formControlName="buildingNumber"
              type="text" 
              class="form-input"
              [class.error]="buildingNumberForm.get('buildingNumber')?.invalid && buildingNumberForm.get('buildingNumber')?.touched"
              placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†ÙŠ"
              (keyup.enter)="searchBuilding()"
            />
            <button type="button" (click)="searchBuilding()" class="btn btn-search">
              <span>ğŸ”</span>
              Ø¨Ø­Ø«
            </button>
          </div>
          @if (buildingNumberForm.get('buildingNumber')?.invalid && buildingNumberForm.get('buildingNumber')?.touched) {
            <span class="error-message">Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†ÙŠ Ù…Ø·Ù„ÙˆØ¨</span>
          }
        </div>
      </form>
    </div>

    <!-- Annexes Form (shown after search) -->
    @if (showForm()) {
      <form [formGroup]="annexesForm" (ngSubmit)="submitData()" class="annexes-form">
        <div formArrayName="annexes">
          @for (annex of annexes.controls; track $index) {
            <div [formGroupName]="$index" class="annex-item">
              <div class="annex-header">
                <h3>Ø§Ù„Ù…Ù„Ø­Ù‚ Ø±Ù‚Ù… {{ $index + 1 }}</h3>
                @if (annexes.length > 1) {
                  <button
                    type="button"
                    (click)="removeAnnex($index)"
                    class="btn-remove"
                  >
                    âœ•
                  </button>
                }
              </div>

        <div class="annex-fields">
          <div class="form-row">
            <div class="form-group">
              <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± <span class="required">*</span></label>
              <input 
                formControlName="totalFloors"
                type="number" 
                class="form-input"
                [class.error]="getAnnexControl($index, 'totalFloors')?.invalid && getAnnexControl($index, 'totalFloors')?.touched"
                placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±"
              />
              @if (getAnnexControl($index, 'totalFloors')?.invalid && getAnnexControl($index, 'totalFloors')?.touched) {
                <span class="error-message">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ù…Ø·Ù„ÙˆØ¨ ÙˆÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±</span>
              }
            </div>

            <div class="form-group">
              <label>Ø­Ø§Ù„Ø© Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ù„Ø­Ù‚ <span class="required">*</span></label>
              <input 
                formControlName="structureCondition"
                type="text" 
                class="form-input"
                [class.error]="getAnnexControl($index, 'structureCondition')?.invalid && getAnnexControl($index, 'structureCondition')?.touched"
                placeholder="Ø£Ø¯Ø®Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ù‡ÙŠÙƒÙ„"
              />
              @if (getAnnexControl($index, 'structureCondition')?.invalid && getAnnexControl($index, 'structureCondition')?.touched) {
                <span class="error-message">Ø­Ø§Ù„Ø© Ø§Ù„Ù‡ÙŠÙƒÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>

            <div class="form-group">
              <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ù„Ø­Ù‚ <span class="required">*</span></label>
              <input 
                formControlName="totalArea"
                type="text" 
                class="form-input"
                [class.error]="getAnnexControl($index, 'totalArea')?.invalid && getAnnexControl($index, 'totalArea')?.touched"
                placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²)"
              />
              @if (getAnnexControl($index, 'totalArea')?.invalid && getAnnexControl($index, 'totalArea')?.touched) {
                <span class="error-message">Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>

            <div class="form-group">
              <label>ØªØ§Ø±ÙŠØ® Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ø­Ù‚ <span class="required">*</span></label>
              <input 
                formControlName="constructionDate"
                type="date" 
                class="form-input"
                [class.error]="getAnnexControl($index, 'constructionDate')?.invalid && getAnnexControl($index, 'constructionDate')?.touched"
              />
              @if (getAnnexControl($index, 'constructionDate')?.invalid && getAnnexControl($index, 'constructionDate')?.touched) {
                <span class="error-message">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø·Ù„ÙˆØ¨</span>
              }
            </div>

            <div class="form-group">
              <label>Ø­Ø§Ù„Ø© ØªØ´Ø·ÙŠØ¨Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ© <span class="required">*</span></label>
              <input 
                formControlName="interiorFinishingCondition"
                type="text" 
                class="form-input"
                [class.error]="getAnnexControl($index, 'interiorFinishingCondition')?.invalid && getAnnexControl($index, 'interiorFinishingCondition')?.touched"
                placeholder="Ø£Ø¯Ø®Ù„ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´Ø·ÙŠØ¨Ø§Øª"
              />
              @if (getAnnexControl($index, 'interiorFinishingCondition')?.invalid && getAnnexControl($index, 'interiorFinishingCondition')?.touched) {
                <span class="error-message">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´Ø·ÙŠØ¨Ø§Øª Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>

            <div class="form-group">
              <label>Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„Ù…Ù„Ø­Ù‚ Ù„Ù„ØªØ¹Ù„ÙŠØ© <span class="required">*</span></label>
              <input 
                formControlName="expansionCapability"
                type="text" 
                class="form-input"
                [class.error]="getAnnexControl($index, 'expansionCapability')?.invalid && getAnnexControl($index, 'expansionCapability')?.touched"
                placeholder="Ø£Ø¯Ø®Ù„ Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠØ©"
              />
              @if (getAnnexControl($index, 'expansionCapability')?.invalid && getAnnexControl($index, 'expansionCapability')?.touched) {
                <span class="error-message">Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>

            <div class="form-group">
              <label>Ù†Ø¸Ø§Ù… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ø­Ù‚ <span class="required">*</span></label>
              <input 
                formControlName="constructionSystem"
                type="text" 
                class="form-input"
                [class.error]="getAnnexControl($index, 'constructionSystem')?.invalid && getAnnexControl($index, 'constructionSystem')?.touched"
                placeholder="Ø£Ø¯Ø®Ù„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡"
              />
              @if (getAnnexControl($index, 'constructionSystem')?.invalid && getAnnexControl($index, 'constructionSystem')?.touched) {
                <span class="error-message">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø·Ù„ÙˆØ¨</span>
              }
            </div>

            <div class="form-group">
              <label>Ø·Ø±ÙŠÙ‚Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ø­Ù‚ <span class="required">*</span></label>
              <input 
                formControlName="constructionMethod"
                type="text" 
                class="form-input"
                [class.error]="getAnnexControl($index, 'constructionMethod')?.invalid && getAnnexControl($index, 'constructionMethod')?.touched"
                placeholder="Ø£Ø¯Ø®Ù„ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡"
              />
              @if (getAnnexControl($index, 'constructionMethod')?.invalid && getAnnexControl($index, 'constructionMethod')?.touched) {
                <span class="error-message">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>

            <div class="form-group">
              <label>Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø£Ø³Ù‚Ù <span class="required">*</span></label>
              <input 
                formControlName="ceilingMaterials"
                type="text" 
                class="form-input"
                [class.error]="getAnnexControl($index, 'ceilingMaterials')?.invalid && getAnnexControl($index, 'ceilingMaterials')?.touched"
                placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø³Ù‚Ù"
              />
              @if (getAnnexControl($index, 'ceilingMaterials')?.invalid && getAnnexControl($index, 'ceilingMaterials')?.touched) {
                <span class="error-message">Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø³Ù‚Ù Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>

            <div class="form-group">
              <label>Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡ Ø­ÙˆØ§Ø¦Ø· Ø§Ù„Ù…Ù„Ø­Ù‚ <span class="required">*</span></label>
              <input 
                formControlName="wallMaterials"
                type="text" 
                class="form-input"
                [class.error]="getAnnexControl($index, 'wallMaterials')?.invalid && getAnnexControl($index, 'wallMaterials')?.touched"
                placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙˆØ§Ø¯ Ø§Ù„Ø­ÙˆØ§Ø¦Ø·"
              />
              @if (getAnnexControl($index, 'wallMaterials')?.invalid && getAnnexControl($index, 'wallMaterials')?.touched) {
                <span class="error-message">Ù…ÙˆØ§Ø¯ Ø§Ù„Ø­ÙˆØ§Ø¦Ø· Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>

            <div class="form-group">
              <label>ØªØ´Ø·ÙŠØ¨ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª Ø®Ø§Ø±Ø¬ÙŠ <span class="required">*</span></label>
              <input 
                formControlName="exteriorFacadeFinishing"
                type="text" 
                class="form-input"
                [class.error]="getAnnexControl($index, 'exteriorFacadeFinishing')?.invalid && getAnnexControl($index, 'exteriorFacadeFinishing')?.touched"
                placeholder="Ø£Ø¯Ø®Ù„ ØªØ´Ø·ÙŠØ¨ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª"
              />
              @if (getAnnexControl($index, 'exteriorFacadeFinishing')?.invalid && getAnnexControl($index, 'exteriorFacadeFinishing')?.touched) {
                <span class="error-message">ØªØ´Ø·ÙŠØ¨ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª Ù…Ø·Ù„ÙˆØ¨</span>
              }
            </div>

            <div class="form-group">
              <label>Ø£Ø¹Ù…Ø§Ù„ ØµØ­ÙŠØ© <span class="required">*</span></label>
              <input 
                formControlName="sanitaryWorks"
                type="text" 
                class="form-input"
                [class.error]="getAnnexControl($index, 'sanitaryWorks')?.invalid && getAnnexControl($index, 'sanitaryWorks')?.touched"
                placeholder="Ø£Ø¯Ø®Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ØµØ­ÙŠØ©"
              />
              @if (getAnnexControl($index, 'sanitaryWorks')?.invalid && getAnnexControl($index, 'sanitaryWorks')?.touched) {
                <span class="error-message">Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ØµØ­ÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>

            <div class="form-group">
              <label>Ø£Ø¹Ù…Ø§Ù„ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© <span class="required">*</span></label>
              <input 
                formControlName="electricalWorks"
                type="text" 
                class="form-input"
                [class.error]="getAnnexControl($index, 'electricalWorks')?.invalid && getAnnexControl($index, 'electricalWorks')?.touched"
                placeholder="Ø£Ø¯Ø®Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©"
              />
              @if (getAnnexControl($index, 'electricalWorks')?.invalid && getAnnexControl($index, 'electricalWorks')?.touched) {
                <span class="error-message">Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>
          </div>
        </div>
      </div>
          }
        </div>

      <button type="button" (click)="addAnnex()" class="btn btn-add">
        <span>â•</span>
        Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø­Ù‚ Ø¬Ø¯ÙŠØ¯
      </button>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">
          <span>ğŸ’¾</span>
          Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </button>
      </div>
    </form>
    }
  </div>
</div>
