<app-header 
  [pageTitle]="'Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©'"
  [showBackButton]="true"
  [showHomeButton]="true"
  (backClicked)="navigateBack()"
  (homeClicked)="goHome()"
  (logoutClicked)="logout()"
></app-header>

<div class="container">
  <div class="page-content">
    <h1>Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©</h1>
    <p class="subtitle">Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³Ø© ÙˆØ§Ù„Ù…Ø¨Ø§Ù†ÙŠ</p>

    <!-- Search Form -->
    <div class="form-wrapper">
      <form [formGroup]="inquiryForm" (ngSubmit)="onSearch()">
        <!-- Basic Location -->
        <div class="form-section">
          <h3 class="section-title">Ø§Ù„Ù…ÙˆÙ‚Ø¹</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="governorate">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© <span class="required">*</span></label>
              <select id="governorate" formControlName="governorate"
                [class.error]="inquiryForm.get('governorate')?.invalid && inquiryForm.get('governorate')?.touched">
                <option value="" disabled>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>
                <option value="cairo">Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</option>
                <option value="giza">Ø§Ù„Ø¬ÙŠØ²Ø©</option>
                <option value="alex">Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
              </select>
              @if (inquiryForm.get('governorate')?.invalid && inquiryForm.get('governorate')?.touched) {
                <span class="error-message">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>

            <div class="form-group">
              <label for="regionalCenter">Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ…ÙŠ <span class="required">*</span></label>
              <input type="text" id="regionalCenter" formControlName="regionalCenter"
                [class.error]="inquiryForm.get('regionalCenter')?.invalid && inquiryForm.get('regionalCenter')?.touched" />
              @if (inquiryForm.get('regionalCenter')?.invalid && inquiryForm.get('regionalCenter')?.touched) {
                <span class="error-message">Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ…ÙŠ Ù…Ø·Ù„ÙˆØ¨</span>
              }
            </div>

            <div class="form-group">
              <label for="educationalAdministration">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© <span class="required">*</span></label>
              <input type="text" id="educationalAdministration" formControlName="educationalAdministration"
                [class.error]="inquiryForm.get('educationalAdministration')?.invalid && inquiryForm.get('educationalAdministration')?.touched" />
              @if (inquiryForm.get('educationalAdministration')?.invalid && inquiryForm.get('educationalAdministration')?.touched) {
                <span class="error-message">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="district">Ø§Ù„Ù‚Ø³Ù…/Ø§Ù„Ù…Ø±ÙƒØ² <span class="required">*</span></label>
              <input type="text" id="district" formControlName="district"
                [class.error]="inquiryForm.get('district')?.invalid && inquiryForm.get('district')?.touched" />
              @if (inquiryForm.get('district')?.invalid && inquiryForm.get('district')?.touched) {
                <span class="error-message">Ø§Ù„Ù‚Ø³Ù…/Ø§Ù„Ù…Ø±ÙƒØ² Ù…Ø·Ù„ÙˆØ¨</span>
              }
            </div>

            <div class="form-group">
              <label for="neighborhood">Ø§Ù„Ø­ÙŠ/Ø§Ù„Ù‚Ø±ÙŠØ© <span class="required">*</span></label>
              <input type="text" id="neighborhood" formControlName="neighborhood"
                [class.error]="inquiryForm.get('neighborhood')?.invalid && inquiryForm.get('neighborhood')?.touched" />
              @if (inquiryForm.get('neighborhood')?.invalid && inquiryForm.get('neighborhood')?.touched) {
                <span class="error-message">Ø§Ù„Ø­ÙŠ/Ø§Ù„Ù‚Ø±ÙŠØ© Ù…Ø·Ù„ÙˆØ¨</span>
              }
            </div>

            <div class="form-group">
              <label for="villageAffiliate">ØªØ§Ø¨Ø¹ Ø§Ù„Ù‚Ø±ÙŠØ©</label>
              <input type="text" id="villageAffiliate" formControlName="villageAffiliate" />
            </div>
          </div>
        </div>

        <!-- Characteristics -->
        <div class="form-section">
          <h3 class="section-title">Ø§Ù„Ø³Ù…Ø§Øª</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="stage">Ø§Ù„Ù…Ø±Ø­Ù„Ø© <span class="required">*</span></label>
              <select id="stage" formControlName="stage"
                [class.error]="inquiryForm.get('stage')?.invalid && inquiryForm.get('stage')?.touched">
                <option value="" disabled>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø©</option>
                <option value="primary">Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                <option value="preparatory">Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option>
                <option value="secondary">Ø«Ø§Ù†ÙˆÙŠ</option>
              </select>
              @if (inquiryForm.get('stage')?.invalid && inquiryForm.get('stage')?.touched) {
                <span class="error-message">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>

            <div class="form-group">
              <label for="affiliation">Ø§Ù„ØªØ¨Ø¹ÙŠØ© <span class="required">*</span></label>
              <select id="affiliation" formControlName="affiliation"
                [class.error]="inquiryForm.get('affiliation')?.invalid && inquiryForm.get('affiliation')?.touched">
                <option value="" disabled>Ø§Ø®ØªØ± Ø§Ù„ØªØ¨Ø¹ÙŠØ©</option>
                <option value="government">Ø­ÙƒÙˆÙ…ÙŠ</option>
                <option value="private">Ø®Ø§Øµ</option>
              </select>
              @if (inquiryForm.get('affiliation')?.invalid && inquiryForm.get('affiliation')?.touched) {
                <span class="error-message">Ø§Ù„ØªØ¨Ø¹ÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>

            <div class="form-group">
              <label for="educationType">Ù†ÙˆØ¹ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ… <span class="required">*</span></label>
              <select id="educationType" formControlName="educationType"
                [class.error]="inquiryForm.get('educationType')?.invalid && inquiryForm.get('educationType')?.touched">
                <option value="" disabled>Ø§Ø®ØªØ± Ù†ÙˆØ¹ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</option>
                <option value="general">Ø¹Ø§Ù…</option>
                <option value="technical">ÙÙ†ÙŠ</option>
              </select>
              @if (inquiryForm.get('educationType')?.invalid && inquiryForm.get('educationType')?.touched) {
                <span class="error-message">Ù†ÙˆØ¹ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="studentType">Ù†ÙˆØ¹ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° <span class="required">*</span></label>
              <select id="studentType" formControlName="studentType"
                [class.error]="inquiryForm.get('studentType')?.invalid && inquiryForm.get('studentType')?.touched">
                <option value="" disabled>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°</option>
                <option value="boys">Ø¨Ù†ÙŠÙ†</option>
                <option value="girls">Ø¨Ù†Ø§Øª</option>
                <option value="mixed">Ù…Ø´ØªØ±Ùƒ</option>
              </select>
              @if (inquiryForm.get('studentType')?.invalid && inquiryForm.get('studentType')?.touched) {
                <span class="error-message">Ù†ÙˆØ¹ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ù…Ø·Ù„ÙˆØ¨</span>
              }
            </div>

            <div class="form-group">
              <label for="landOwnership">Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø£Ø±Ø¶ <span class="required">*</span></label>
              <select id="landOwnership" formControlName="landOwnership"
                [class.error]="inquiryForm.get('landOwnership')?.invalid && inquiryForm.get('landOwnership')?.touched">
                <option value="" disabled>Ø§Ø®ØªØ± Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø£Ø±Ø¶</option>
                <option value="government">Ø­ÙƒÙˆÙ…ÙŠ</option>
                <option value="private">Ø®Ø§Øµ</option>
                <option value="rental">Ø¥ÙŠØ¬Ø§Ø±</option>
              </select>
              @if (inquiryForm.get('landOwnership')?.invalid && inquiryForm.get('landOwnership')?.touched) {
                <span class="error-message">Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø£Ø±Ø¶ Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>

            <div class="form-group">
              <label for="buildingOwnership">Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ù…Ø¨Ù†Ù‰ <span class="required">*</span></label>
              <select id="buildingOwnership" formControlName="buildingOwnership"
                [class.error]="inquiryForm.get('buildingOwnership')?.invalid && inquiryForm.get('buildingOwnership')?.touched">
                <option value="" disabled>Ø§Ø®ØªØ± Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ù…Ø¨Ù†Ù‰</option>
                <option value="government">Ø­ÙƒÙˆÙ…ÙŠ</option>
                <option value="private">Ø®Ø§Øµ</option>
                <option value="rental">Ø¥ÙŠØ¬Ø§Ø±</option>
              </select>
              @if (inquiryForm.get('buildingOwnership')?.invalid && inquiryForm.get('buildingOwnership')?.touched) {
                <span class="error-message">Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ù…Ø¨Ù†Ù‰ Ù…Ø·Ù„ÙˆØ¨Ø©</span>
              }
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="usageStatus">Ù…ÙˆÙ‚Ù Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… <span class="required">*</span></label>
              <select id="usageStatus" formControlName="usageStatus"
                [class.error]="inquiryForm.get('usageStatus')?.invalid && inquiryForm.get('usageStatus')?.touched">
                <option value="" disabled>Ø§Ø®ØªØ± Ù…ÙˆÙ‚Ù Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</option>
                <option value="active">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</option>
                <option value="inactive">ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…</option>
              </select>
              @if (inquiryForm.get('usageStatus')?.invalid && inquiryForm.get('usageStatus')?.touched) {
                <span class="error-message">Ù…ÙˆÙ‚Ù Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø·Ù„ÙˆØ¨</span>
              }
            </div>

            <div class="form-group">
              <label for="buildingName">Ø§Ø³Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰ <span class="required">*</span></label>
              <input type="text" id="buildingName" formControlName="buildingName"
                [class.error]="inquiryForm.get('buildingName')?.invalid && inquiryForm.get('buildingName')?.touched" />
              @if (inquiryForm.get('buildingName')?.invalid && inquiryForm.get('buildingName')?.touched) {
                <span class="error-message">Ø§Ø³Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰ Ù…Ø·Ù„ÙˆØ¨</span>
              }
            </div>

            <div class="form-group">
              <label for="buildingNumber">Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰ <span class="required">*</span></label>
              <input type="text" id="buildingNumber" formControlName="buildingNumber"
                [class.error]="inquiryForm.get('buildingNumber')?.invalid && inquiryForm.get('buildingNumber')?.touched" />
              @if (inquiryForm.get('buildingNumber')?.invalid && inquiryForm.get('buildingNumber')?.touched) {
                <span class="error-message">Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰ Ù…Ø·Ù„ÙˆØ¨</span>
              }
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">
            <span>ï¿½</span>
            ØªÙØ¹ÙŠÙ„
          </button>
          <button type="button" class="btn btn-secondary" (click)="onReset()">
            <span>ğŸ”„</span>
            Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
          </button>
        </div>
      </form>
    </div>

    <!-- Options Cards -->
    <div class="options-section">
      <h2 class="options-title">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
      <div class="options-grid">
        @for (option of mapOptions; track option.id) {
          <div (click)="navigateToOption(option.route)" class="option-card">
            <div class="option-icon">{{ option.icon }}</div>
            <h3>{{ option.title }}</h3>
            <p>{{ option.description }}</p>
            <span class="arrow">â†’</span>
          </div>
        }
      </div>
    </div>
  </div>
</div>

<!-- Search Results Modal -->
@if (showModal()) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</h2>
        <button class="modal-close" (click)="closeModal()">Ã—</button>
      </div>

      <div class="modal-body">
        @if (searchResults().length > 0) {
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰</th>
                  <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</th>
                  <th>Ù…ÙˆÙ‚Ù Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</th>
                  <th>ØªØ¨Ø¹ÙŠØ©</th>
                  <th>Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ù…Ø¨Ù†Ù‰</th>
                </tr>
              </thead>
              <tbody>
                @for (item of searchResults(); track $index) {
                  <tr>
                    <td>{{ $index + 1 }}</td>
                    <td>{{ item.buildingNumber }}</td>
                    <td>{{ item.schoolName }}</td>
                    <td>{{ item.usageStatus }}</td>
                    <td>{{ item.affiliation }}</td>
                    <td>{{ item.buildingOwnership }}</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        } @else {
          <div class="empty-state">
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>
          </div>
        }
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>
}
