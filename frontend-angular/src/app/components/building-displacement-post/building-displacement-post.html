<app-header 
  [pageTitle]="'ุฅุฏุฎุงู ุจูุงูุงุช ูุฒุน ุงูููููุฉ'"
  [showBackButton]="true"
  [showHomeButton]="true"
  (backClicked)="navigateBack()"
  (homeClicked)="goHome()"
  (logoutClicked)="logout()"
></app-header>

<div class="container">
  <div class="form-wrapper">
    <div class="page-header">
      <h1>ุฅุฏุฎุงู ุจูุงูุงุช ูุฒุน ุงูููููุฉ ุจุนุฏ ูุฑุงุฑ ุฑุฆูุณ ุงููุฒุฑุงุก</h1>
    </div>

    <form [formGroup]="displacementPostForm" (ngSubmit)="onSubmit()">
      
      <!-- Basic Information Section -->
      <div class="form-section">
        <h2 class="section-title">ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="branchCode">ููุฏ ุงููุฑุน <span class="required">*</span></label>
            <input 
              type="text" 
              id="branchCode" 
              formControlName="branchCode"
              [class.error]="displacementPostForm.get('branchCode')?.invalid && displacementPostForm.get('branchCode')?.touched"
            />
            @if (displacementPostForm.get('branchCode')?.invalid && displacementPostForm.get('branchCode')?.touched) {
              <span class="error-message">ููุฏ ุงููุฑุน ูุทููุจ</span>
            }
          </div>

          <div class="form-group">
            <label for="rentedBuildingCode">ููุฏ ุงููุจูู ุงููุคุฌุฑ <span class="required">*</span></label>
            <input 
              type="text" 
              id="rentedBuildingCode" 
              formControlName="rentedBuildingCode"
              [class.error]="displacementPostForm.get('rentedBuildingCode')?.invalid && displacementPostForm.get('rentedBuildingCode')?.touched"
            />
            @if (displacementPostForm.get('rentedBuildingCode')?.invalid && displacementPostForm.get('rentedBuildingCode')?.touched) {
              <span class="error-message">ููุฏ ุงููุจูู ุงููุคุฌุฑ ูุทููุจ</span>
            }
          </div>
        </div>
      </div>

      <!-- Cabinet Decision Section -->
      <div class="form-section">
        <h2 class="section-title">ูุฑุงุฑ ูุฌูุณ ุงููุฒุฑุงุก</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="cabinetDecisionNumber">ุฑูู ุงููุฑุงุฑ <span class="required">*</span></label>
            <input 
              type="text" 
              id="cabinetDecisionNumber" 
              formControlName="cabinetDecisionNumber"
              [class.error]="displacementPostForm.get('cabinetDecisionNumber')?.invalid && displacementPostForm.get('cabinetDecisionNumber')?.touched"
            />
            @if (displacementPostForm.get('cabinetDecisionNumber')?.invalid && displacementPostForm.get('cabinetDecisionNumber')?.touched) {
              <span class="error-message">ุฑูู ุงููุฑุงุฑ ูุทููุจ</span>
            }
          </div>

          <div class="form-group">
            <label for="cabinetDecisionDate">ุชุงุฑูุฎ ุงููุฑุงุฑ <span class="required">*</span></label>
            <input 
              type="date" 
              id="cabinetDecisionDate" 
              formControlName="cabinetDecisionDate"
              [class.error]="displacementPostForm.get('cabinetDecisionDate')?.invalid && displacementPostForm.get('cabinetDecisionDate')?.touched"
            />
            @if (displacementPostForm.get('cabinetDecisionDate')?.invalid && displacementPostForm.get('cabinetDecisionDate')?.touched) {
              <span class="error-message">ุชุงุฑูุฎ ุงููุฑุงุฑ ูุทููุจ</span>
            }
          </div>
        </div>
      </div>

      <!-- Official Gazette Publication Section -->
      <div class="form-section">
        <h2 class="section-title">ุงููุดุฑ ูู ุฌุฑูุฏุฉ ุฑุณููุฉ</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="publicationCount">ุนุฏุฏ ุงููุดุฑ <span class="required">*</span></label>
            <input 
              type="number" 
              id="publicationCount" 
              formControlName="publicationCount"
              [class.error]="displacementPostForm.get('publicationCount')?.invalid && displacementPostForm.get('publicationCount')?.touched"
            />
            @if (displacementPostForm.get('publicationCount')?.invalid && displacementPostForm.get('publicationCount')?.touched) {
              <span class="error-message">ุนุฏุฏ ุงููุดุฑ ูุทููุจ</span>
            }
          </div>

          <div class="form-group">
            <label for="publicationDate">ุชุงุฑูุฎ ุงููุดุฑ <span class="required">*</span></label>
            <input 
              type="date" 
              id="publicationDate" 
              formControlName="publicationDate"
              [class.error]="displacementPostForm.get('publicationDate')?.invalid && displacementPostForm.get('publicationDate')?.touched"
            />
            @if (displacementPostForm.get('publicationDate')?.invalid && displacementPostForm.get('publicationDate')?.touched) {
              <span class="error-message">ุชุงุฑูุฎ ุงููุดุฑ ูุทููุจ</span>
            }
          </div>

          <div class="form-group">
            <label for="educationProject">ูุดุฑูุน ุชุฑุจูุฉ ูุชุนููู <span class="required">*</span></label>
            <input 
              type="text" 
              id="educationProject" 
              formControlName="educationProject"
              [class.error]="displacementPostForm.get('educationProject')?.invalid && displacementPostForm.get('educationProject')?.touched"
            />
            @if (displacementPostForm.get('educationProject')?.invalid && displacementPostForm.get('educationProject')?.touched) {
              <span class="error-message">ูุดุฑูุน ุชุฑุจูุฉ ูุชุนููู ูุทููุจ</span>
            }
          </div>
        </div>
      </div>

      <!-- Display Lists Section -->
      <div class="form-section">
        <h2 class="section-title">ูุดูู ุงูุนุฑุถ</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="ownersCount">ุนุฏุฏ ุงูููุงู <span class="required">*</span></label>
            <input 
              type="number" 
              id="ownersCount" 
              formControlName="ownersCount"
              [class.error]="displacementPostForm.get('ownersCount')?.invalid && displacementPostForm.get('ownersCount')?.touched"
            />
            @if (displacementPostForm.get('ownersCount')?.invalid && displacementPostForm.get('ownersCount')?.touched) {
              <span class="error-message">ุนุฏุฏ ุงูููุงู ูุทููุจ</span>
            }
          </div>

          <div class="form-group">
            <label for="pricePerMeter">ุณุนุฑ ุงููุชุฑ <span class="required">*</span></label>
            <input 
              type="number" 
              id="pricePerMeter" 
              formControlName="pricePerMeter"
              [class.error]="displacementPostForm.get('pricePerMeter')?.invalid && displacementPostForm.get('pricePerMeter')?.touched"
            />
            @if (displacementPostForm.get('pricePerMeter')?.invalid && displacementPostForm.get('pricePerMeter')?.touched) {
              <span class="error-message">ุณุนุฑ ุงููุชุฑ ูุทููุจ</span>
            }
          </div>

          <div class="form-group">
            <label for="dateFrom">ุชุงุฑูุฎ ูู <span class="required">*</span></label>
            <input 
              type="date" 
              id="dateFrom" 
              formControlName="dateFrom"
              [class.error]="displacementPostForm.get('dateFrom')?.invalid && displacementPostForm.get('dateFrom')?.touched"
            />
            @if (displacementPostForm.get('dateFrom')?.invalid && displacementPostForm.get('dateFrom')?.touched) {
              <span class="error-message">ุชุงุฑูุฎ ูู ูุทููุจ</span>
            }
          </div>

          <div class="form-group">
            <label for="dateTo">ุชุงุฑูุฎ ุฅูู <span class="required">*</span></label>
            <input 
              type="date" 
              id="dateTo" 
              formControlName="dateTo"
              [class.error]="displacementPostForm.get('dateTo')?.invalid && displacementPostForm.get('dateTo')?.touched"
            />
            @if (displacementPostForm.get('dateTo')?.invalid && displacementPostForm.get('dateTo')?.touched) {
              <span class="error-message">ุชุงุฑูุฎ ุฅูู ูุทููุจ</span>
            }
          </div>
        </div>
      </div>

      <!-- Sale Forms Section -->
      <div class="form-section">
        <h2 class="section-title">ุงุณุชูุงุฑุงุช ุงูุจูุน</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="formsCount">ุนุฏุฏ ุงูุงุณุชูุงุฑุงุช <span class="required">*</span></label>
            <input 
              type="number" 
              id="formsCount" 
              formControlName="formsCount"
              [class.error]="displacementPostForm.get('formsCount')?.invalid && displacementPostForm.get('formsCount')?.touched"
            />
            @if (displacementPostForm.get('formsCount')?.invalid && displacementPostForm.get('formsCount')?.touched) {
              <span class="error-message">ุนุฏุฏ ุงูุงุณุชูุงุฑุงุช ูุทููุจ</span>
            }
          </div>
        </div>
      </div>

      <!-- Status Messages -->
      @if (submitStatus() === 'success') {
        <div class="status-message success">
          โ ุชู ุญูุธ ุงูุจูุงูุงุช ุจูุฌุงุญ
        </div>
      }
      @if (submitStatus() === 'error') {
        <div class="status-message error">
          โ ูุฑุฌู ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ
        </div>
      }

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">
          ุญูุธ ุงูุจูุงูุงุช
        </button>
        <button type="button" class="btn btn-secondary" (click)="onReset()">
          ูุณุญ ุงููููุฐุฌ
        </button>
        <button type="button" class="btn btn-tertiary" (click)="navigateBack()">
          ุฑุฌูุน
        </button>
      </div>
    </form>

    <!-- Options Cards Section -->
    <div class="cards-section">
      <h2 class="cards-title">ุงูุฎูุงุฑุงุช ุงูุฅุถุงููุฉ</h2>
      <div class="options-grid">
        @for (option of options; track option.id) {
          <div class="option-card" (click)="selectOption(option.id)">
            <div class="option-icon">{{ option.icon }}</div>
            <h3>{{ option.title }}</h3>
            <span class="arrow">โ</span>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Final Compensation Modal -->
  @if (showFinalCompensationModal()) {
    <div class="modal-overlay" (click)="closeFinalCompensationModal()">
      <div class="modal-content modal-large" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>ุงูุชุนููุถ ุงูููุงุฆู</h2>
          <button class="modal-close" (click)="closeFinalCompensationModal()">ร</button>
        </div>

        <div class="modal-body">
          <!-- School Info -->
          <div class="school-info">
            <div class="school-info-item">
              <span class="info-label">ุฑูู ุงููุฏุฑุณุฉ:</span>
              <span class="info-value">{{ schoolNumber() }}</span>
            </div>
            <div class="school-info-item">
              <span class="info-label">ุงุณู ุงููุฏุฑุณุฉ:</span>
              <span class="info-value">{{ schoolName() }}</span>
            </div>
          </div>

          <!-- Add Form -->
          <form [formGroup]="finalCompensationForm" (ngSubmit)="submitFinalCompensation()">
            <div class="form-row">
              <div class="form-group">
                <label for="checkNumber">ุฑูู ุงูุดูู <span class="required">*</span></label>
                <input 
                  type="text" 
                  id="checkNumber" 
                  formControlName="checkNumber"
                  [class.error]="finalCompensationForm.get('checkNumber')?.invalid && finalCompensationForm.get('checkNumber')?.touched"
                />
                @if (finalCompensationForm.get('checkNumber')?.invalid && finalCompensationForm.get('checkNumber')?.touched) {
                  <span class="error-message">ุฑูู ุงูุดูู ูุทููุจ</span>
                }
              </div>

              <div class="form-group">
                <label for="value">ุงููููุฉ <span class="required">*</span></label>
                <input 
                  type="number" 
                  id="value" 
                  formControlName="value"
                  [class.error]="finalCompensationForm.get('value')?.invalid && finalCompensationForm.get('value')?.touched"
                />
                @if (finalCompensationForm.get('value')?.invalid && finalCompensationForm.get('value')?.touched) {
                  <span class="error-message">ุงููููุฉ ูุทููุจุฉ</span>
                }
              </div>

              <div class="form-group">
                <label for="date">ุงูุชุงุฑูุฎ <span class="required">*</span></label>
                <input 
                  type="date" 
                  id="date" 
                  formControlName="date"
                  [class.error]="finalCompensationForm.get('date')?.invalid && finalCompensationForm.get('date')?.touched"
                />
                @if (finalCompensationForm.get('date')?.invalid && finalCompensationForm.get('date')?.touched) {
                  <span class="error-message">ุงูุชุงุฑูุฎ ูุทููุจ</span>
                }
              </div>

              <div class="form-group">
                <label>&nbsp;</label>
                <button type="submit" class="btn btn-add">
                  + ุฅุถุงูุฉ
                </button>
              </div>
            </div>
          </form>

          <!-- Table -->
          @if (finalCompensationList().length > 0) {
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>ุฑูู ุงูุดูู</th>
                    <th>ุงููููุฉ</th>
                    <th>ุงูุชุงุฑูุฎ</th>
                    <th>ุญุฐู</th>
                  </tr>
                </thead>
                <tbody>
                  @for (item of finalCompensationList(); track $index) {
                    <tr>
                      <td>{{ $index + 1 }}</td>
                      <td>{{ item.checkNumber }}</td>
                      <td>{{ item.value }}</td>
                      <td>{{ item.date }}</td>
                      <td>
                        <button 
                          type="button" 
                          class="btn-delete" 
                          (click)="deleteFinalCompensation($index)"
                          title="ุญุฐู"
                        >
                          ๐๏ธ
                        </button>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          } @else {
            <div class="empty-state">
              <p>ูุง ุชูุฌุฏ ุจูุงูุงุช. ูู ุจุฅุถุงูุฉ ุชุนููุถ ุฌุฏูุฏ.</p>
            </div>
          }
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-primary" (click)="closeFinalCompensationModal()">
            ุญูุธ ูุฅุบูุงู
          </button>
          <button type="button" class="btn btn-tertiary" (click)="closeFinalCompensationModal()">
            ุฅูุบุงุก
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Display Lists Modal (ูุดูู ุงูุนุฑุถ) -->
  @if (showDisplayListsModal()) {
    <div class="modal-overlay" (click)="closeDisplayListsModal()">
      <div class="modal-content modal-large" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>ูุดูู ุงูุนุฑุถ</h2>
          <button class="modal-close" (click)="closeDisplayListsModal()">ร</button>
        </div>

        <div class="modal-body">
          <!-- School Info -->
          <div class="school-info">
            <div class="school-info-item">
              <span class="info-label">ุฑูู ุงููุฏุฑุณุฉ:</span>
              <span class="info-value">{{ schoolNumber() }}</span>
            </div>
            <div class="school-info-item">
              <span class="info-label">ุงุณู ุงููุฏุฑุณุฉ:</span>
              <span class="info-value">{{ schoolName() }}</span>
            </div>
          </div>

          <form [formGroup]="displayListsForm" (ngSubmit)="submitDisplayLists()">
            <div class="form-row">
              <div class="form-group">
                <label for="displayListNumber">ุฑูู ูุดู ุงูุนุฑุถ <span class="required">*</span></label>
                <input type="text" id="displayListNumber" formControlName="displayListNumber"
                  [class.error]="displayListsForm.get('displayListNumber')?.invalid && displayListsForm.get('displayListNumber')?.touched" />
                @if (displayListsForm.get('displayListNumber')?.invalid && displayListsForm.get('displayListNumber')?.touched) {
                  <span class="error-message">ุฑูู ูุดู ุงูุนุฑุถ ูุทููุจ</span>
                }
              </div>

              <div class="form-group">
                <label for="dlDisplacementDecisionNumber">ุฑูู ูุฑุงุฑ ุงููุฒุน <span class="required">*</span></label>
                <input type="text" id="dlDisplacementDecisionNumber" formControlName="displacementDecisionNumber"
                  [class.error]="displayListsForm.get('displacementDecisionNumber')?.invalid && displayListsForm.get('displacementDecisionNumber')?.touched" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="dlSerialId">ุงููุณูุณู (ID) <span class="required">*</span></label>
                <input type="text" id="dlSerialId" formControlName="serialId"
                  [class.error]="displayListsForm.get('serialId')?.invalid && displayListsForm.get('serialId')?.touched" />
              </div>

              <div class="form-group">
                <label for="dlOwnerName">ุงุณู ุตุงุญุจ ุงูุดุฃู <span class="required">*</span></label>
                <input type="text" id="dlOwnerName" formControlName="ownerName"
                  [class.error]="displayListsForm.get('ownerName')?.invalid && displayListsForm.get('ownerName')?.touched" />
              </div>

              <div class="form-group">
                <label for="dlArea">ุงููุณุงุญุฉ <span class="required">*</span></label>
                <input type="number" id="dlArea" formControlName="area"
                  [class.error]="displayListsForm.get('area')?.invalid && displayListsForm.get('area')?.touched" />
              </div>

              <div class="form-group">
                <label>&nbsp;</label>
                <button type="submit" class="btn btn-add">+ ุฅุถุงูุฉ</button>
              </div>
            </div>
          </form>

          @if (displayListsList().length > 0) {
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>ุฑูู ูุดู ุงูุนุฑุถ</th>
                    <th>ุฑูู ูุฑุงุฑ ุงููุฒุน</th>
                    <th>ุงููุณูุณู</th>
                    <th>ุงุณู ุตุงุญุจ ุงูุดุฃู</th>
                    <th>ุงููุณุงุญุฉ</th>
                    <th>ุงูุฅุฌุฑุงุกุงุช</th>
                  </tr>
                </thead>
                <tbody>
                  @for (item of displayListsList(); track $index) {
                    <tr>
                      <td>{{ $index + 1 }}</td>
                      <td>{{ item.displayListNumber }}</td>
                      <td>{{ item.displacementDecisionNumber }}</td>
                      <td>{{ item.serialId }}</td>
                      <td>{{ item.ownerName }}</td>
                      <td>{{ item.area }}</td>
                      <td>
                        <button type="button" class="btn-delete" (click)="deleteDisplayLists($index)" title="ุญุฐู">๐๏ธ</button>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          } @else {
            <div class="empty-state"><p>ูุง ุชูุฌุฏ ุจูุงูุงุช. ูู ุจุฅุถุงูุฉ ูุดู ุฌุฏูุฏ.</p></div>
          }
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-primary" (click)="closeDisplayListsModal()">ุญูุธ ูุฅุบูุงู</button>
          <button type="button" class="btn btn-tertiary" (click)="closeDisplayListsModal()">ุฅูุบุงุก</button>
        </div>
      </div>
    </div>
  }

  <!-- Conformity Certificates Modal (ุดูุงุฏุงุช ุงููุทุงุจูุฉ) -->
  @if (showConformityCertificatesModal()) {
    <div class="modal-overlay" (click)="closeConformityCertificatesModal()">
      <div class="modal-content modal-large" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>ุดูุงุฏุงุช ุงููุทุงุจูุฉ</h2>
          <button class="modal-close" (click)="closeConformityCertificatesModal()">ร</button>
        </div>

        <div class="modal-body">
          <!-- School Info -->
          <div class="school-info">
            <div class="school-info-item">
              <span class="info-label">ุฑูู ุงููุฏุฑุณุฉ:</span>
              <span class="info-value">{{ schoolNumber() }}</span>
            </div>
            <div class="school-info-item">
              <span class="info-label">ุงุณู ุงููุฏุฑุณุฉ:</span>
              <span class="info-value">{{ schoolName() }}</span>
            </div>
          </div>

          <form [formGroup]="conformityCertificatesForm" (ngSubmit)="submitConformityCertificates()">
            <div class="form-row">
              <div class="form-group">
                <label for="ccFormType">ููุน ุงูุงุณุชูุงุฑุฉ <span class="required">*</span></label>
                <select id="ccFormType" formControlName="formType"
                  [class.error]="conformityCertificatesForm.get('formType')?.invalid && conformityCertificatesForm.get('formType')?.touched">
                  <option value="" disabled>ุงุฎุชุฑ ููุน ุงูุงุณุชูุงุฑุฉ</option>
                  <option value="real-estate">ุดูุฑ ุนูุงุฑู</option>
                  <option value="civil-registry">ุณุฌู ูุฏูู</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="ccCertificateNumber">ุฑูู ุดูุงุฏุฉ ูุทุงุจูุฉ <span class="required">*</span></label>
                <input type="text" id="ccCertificateNumber" formControlName="certificateNumber"
                  [class.error]="conformityCertificatesForm.get('certificateNumber')?.invalid && conformityCertificatesForm.get('certificateNumber')?.touched" />
              </div>

              <div class="form-group">
                <label for="ccOwnerName">ุงุณู ุตุงุญุจ ุงูุดุฃู <span class="required">*</span></label>
                <input type="text" id="ccOwnerName" formControlName="ownerName"
                  [class.error]="conformityCertificatesForm.get('ownerName')?.invalid && conformityCertificatesForm.get('ownerName')?.touched" />
              </div>

              <div class="form-group">
                <label for="ccRegistrationNumber">ุฑูู ุดูุงุฏุฉ ูููุฏ <span class="required">*</span></label>
                <input type="text" id="ccRegistrationNumber" formControlName="registrationNumber"
                  [class.error]="conformityCertificatesForm.get('registrationNumber')?.invalid && conformityCertificatesForm.get('registrationNumber')?.touched" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="ccDate">ุงูุชุงุฑูุฎ <span class="required">*</span></label>
                <input type="date" id="ccDate" formControlName="date"
                  [class.error]="conformityCertificatesForm.get('date')?.invalid && conformityCertificatesForm.get('date')?.touched" />
              </div>

              <div class="form-group">
                <label for="ccArea">ุงููุณุงุญุฉ <span class="required">*</span></label>
                <input type="number" id="ccArea" formControlName="area"
                  [class.error]="conformityCertificatesForm.get('area')?.invalid && conformityCertificatesForm.get('area')?.touched" />
              </div>

              <div class="form-group">
                <label for="ccValue">ุงููููุฉ <span class="required">*</span></label>
                <input type="number" id="ccValue" formControlName="value"
                  [class.error]="conformityCertificatesForm.get('value')?.invalid && conformityCertificatesForm.get('value')?.touched" />
              </div>

              <div class="form-group">
                <label>&nbsp;</label>
                <button type="submit" class="btn btn-add">+ ุฅุถุงูุฉ</button>
              </div>
            </div>
          </form>

          @if (conformityCertificatesList().length > 0) {
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>ููุน ุงูุงุณุชูุงุฑุฉ</th>
                    <th>ุฑูู ุงูุดูุงุฏุฉ</th>
                    <th>ุงุณู ุตุงุญุจ ุงูุดุฃู</th>
                    <th>ุฑูู ูููุฏ</th>
                    <th>ุงูุชุงุฑูุฎ</th>
                    <th>ุงููุณุงุญุฉ</th>
                    <th>ุงููููุฉ</th>
                    <th>ุงูุฅุฌุฑุงุกุงุช</th>
                  </tr>
                </thead>
                <tbody>
                  @for (item of conformityCertificatesList(); track $index) {
                    <tr>
                      <td>{{ $index + 1 }}</td>
                      <td>{{ item.formType === 'real-estate' ? 'ุดูุฑ ุนูุงุฑู' : 'ุณุฌู ูุฏูู' }}</td>
                      <td>{{ item.certificateNumber }}</td>
                      <td>{{ item.ownerName }}</td>
                      <td>{{ item.registrationNumber }}</td>
                      <td>{{ item.date }}</td>
                      <td>{{ item.area }}</td>
                      <td>{{ item.value }}</td>
                      <td>
                        <button type="button" class="btn-delete" (click)="deleteConformityCertificates($index)" title="ุญุฐู">๐๏ธ</button>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          } @else {
            <div class="empty-state"><p>ูุง ุชูุฌุฏ ุจูุงูุงุช. ูู ุจุฅุถุงูุฉ ุดูุงุฏุฉ ุฌุฏูุฏุฉ.</p></div>
          }
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-primary" (click)="closeConformityCertificatesModal()">ุญูุธ ูุฅุบูุงู</button>
          <button type="button" class="btn btn-tertiary" (click)="closeConformityCertificatesModal()">ุฅูุบุงุก</button>
        </div>
      </div>
    </div>
  }

  <!-- Real Estate Unit Modal (ุตุญููุฉ ูุญุฏุฉ ุนูุงุฑูุฉ) -->
  @if (showRealEstateUnitModal()) {
    <div class="modal-overlay" (click)="closeRealEstateUnitModal()">
      <div class="modal-content modal-large" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>ุตุญููุฉ ูุญุฏุฉ ุตุญูุฉ</h2>
          <button class="modal-close" (click)="closeRealEstateUnitModal()">ร</button>
        </div>

        <div class="modal-body">
          <!-- School Info -->
          <div class="school-info">
            <div class="school-info-item">
              <span class="info-label">ุฑูู ุงููุฏุฑุณุฉ:</span>
              <span class="info-value">{{ schoolNumber() }}</span>
            </div>
            <div class="school-info-item">
              <span class="info-label">ุงุณู ุงููุฏุฑุณุฉ:</span>
              <span class="info-value">{{ schoolName() }}</span>
            </div>
          </div>

          <form [formGroup]="realEstateUnitForm" (ngSubmit)="submitRealEstateUnit()">
            <div class="form-row">
              <div class="form-group">
                <label for="reuUnitNumber">ุฑูู ุงููุญุฏุฉ <span class="required">*</span></label>
                <input type="text" id="reuUnitNumber" formControlName="unitNumber"
                  [class.error]="realEstateUnitForm.get('unitNumber')?.invalid && realEstateUnitForm.get('unitNumber')?.touched" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="reuBasinNumber">ุฑูู ุงูุญูุถ <span class="required">*</span></label>
                <input type="text" id="reuBasinNumber" formControlName="basinNumber"
                  [class.error]="realEstateUnitForm.get('basinNumber')?.invalid && realEstateUnitForm.get('basinNumber')?.touched" />
              </div>

              <div class="form-group">
                <label for="reuBasinName">ุงุณู ุงูุญูุถ <span class="required">*</span></label>
                <input type="text" id="reuBasinName" formControlName="basinName"
                  [class.error]="realEstateUnitForm.get('basinName')?.invalid && realEstateUnitForm.get('basinName')?.touched" />
              </div>

              <div class="form-group">
                <label for="reuOwnershipReason">ุณุจุจ ุงูุชููู <span class="required">*</span></label>
                <input type="text" id="reuOwnershipReason" formControlName="ownershipReason"
                  [class.error]="realEstateUnitForm.get('ownershipReason')?.invalid && realEstateUnitForm.get('ownershipReason')?.touched" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="reuDate">ุงูุชุงุฑูุฎ <span class="required">*</span></label>
                <input type="date" id="reuDate" formControlName="date"
                  [class.error]="realEstateUnitForm.get('date')?.invalid && realEstateUnitForm.get('date')?.touched" />
              </div>

              <div class="form-group">
                <label for="reuArea">ุงููุณุงุญุฉ <span class="required">*</span></label>
                <input type="number" id="reuArea" formControlName="area"
                  [class.error]="realEstateUnitForm.get('area')?.invalid && realEstateUnitForm.get('area')?.touched" />
              </div>

              <div class="form-group">
                <label>&nbsp;</label>
                <button type="submit" class="btn btn-add">+ ุฅุถุงูุฉ</button>
              </div>
            </div>
          </form>

          @if (realEstateUnitList().length > 0) {
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>ุฑูู ุงููุญุฏุฉ</th>
                    <th>ุฑูู ุงูุญูุถ</th>
                    <th>ุงุณู ุงูุญูุถ</th>
                    <th>ุณุจุจ ุงูุชููู</th>
                    <th>ุงูุชุงุฑูุฎ</th>
                    <th>ุงููุณุงุญุฉ</th>
                    <th>ุงูุฅุฌุฑุงุกุงุช</th>
                  </tr>
                </thead>
                <tbody>
                  @for (item of realEstateUnitList(); track $index) {
                    <tr>
                      <td>{{ $index + 1 }}</td>
                      <td>{{ item.unitNumber }}</td>
                      <td>{{ item.basinNumber }}</td>
                      <td>{{ item.basinName }}</td>
                      <td>{{ item.ownershipReason }}</td>
                      <td>{{ item.date }}</td>
                      <td>{{ item.area }}</td>
                      <td>
                        <button type="button" class="btn-delete" (click)="deleteRealEstateUnit($index)" title="ุญุฐู">๐๏ธ</button>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          } @else {
            <div class="empty-state"><p>ูุง ุชูุฌุฏ ุจูุงูุงุช. ูู ุจุฅุถุงูุฉ ูุญุฏุฉ ุนูุงุฑูุฉ ุฌุฏูุฏุฉ.</p></div>
          }
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-primary" (click)="closeRealEstateUnitModal()">ุญูุธ ูุฅุบูุงู</button>
          <button type="button" class="btn btn-tertiary" (click)="closeRealEstateUnitModal()">ุฅูุบุงุก</button>
        </div>
      </div>
    </div>
  }

  <!-- Minister Decision Modal (ูุฑุงุฑ ุงููุฒูุฑ ุงููุฎุชุต) -->
  @if (showMinisterDecisionModal()) {
    <div class="modal-overlay" (click)="closeMinisterDecisionModal()">
      <div class="modal-content modal-large" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>ูุฑุงุฑ ุงููุฒูุฑ ุงููุฎุชุต</h2>
          <button class="modal-close" (click)="closeMinisterDecisionModal()">ร</button>
        </div>

        <div class="modal-body">
          <!-- School Info -->
          <div class="school-info">
            <div class="school-info-item">
              <span class="info-label">ุฑูู ุงููุฏุฑุณุฉ:</span>
              <span class="info-value">{{ schoolNumber() }}</span>
            </div>
            <div class="school-info-item">
              <span class="info-label">ุงุณู ุงููุฏุฑุณุฉ:</span>
              <span class="info-value">{{ schoolName() }}</span>
            </div>
          </div>

          <form [formGroup]="ministerDecisionForm" (ngSubmit)="submitMinisterDecision()">
            <!-- Minister Decision Section -->
            <div class="subsection">
              <h3 class="subsection-title">ูุฑุงุฑ ุงููุฒูุฑ ุงููุฎุชุต</h3>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="mdDecisionNumber">ุฑูู ุงููุฑุงุฑ <span class="required">*</span></label>
                  <input type="text" id="mdDecisionNumber" formControlName="decisionNumber"
                    [class.error]="ministerDecisionForm.get('decisionNumber')?.invalid && ministerDecisionForm.get('decisionNumber')?.touched" />
                  @if (ministerDecisionForm.get('decisionNumber')?.invalid && ministerDecisionForm.get('decisionNumber')?.touched) {
                    <span class="error-message">ุฑูู ุงููุฑุงุฑ ูุทููุจ</span>
                  }
                </div>

                <div class="form-group">
                  <label for="mdDecisionDate">ุชุงุฑูุฎ ุงููุฑุงุฑ <span class="required">*</span></label>
                  <input type="date" id="mdDecisionDate" formControlName="decisionDate"
                    [class.error]="ministerDecisionForm.get('decisionDate')?.invalid && ministerDecisionForm.get('decisionDate')?.touched" />
                  @if (ministerDecisionForm.get('decisionDate')?.invalid && ministerDecisionForm.get('decisionDate')?.touched) {
                    <span class="error-message">ุชุงุฑูุฎ ุงููุฑุงุฑ ูุทููุจ</span>
                  }
                </div>

                <div class="form-group">
                  <label for="mdRegisteredNumber">ูุดูุฑ ุจุฑูู <span class="required">*</span></label>
                  <input type="text" id="mdRegisteredNumber" formControlName="registeredNumber"
                    [class.error]="ministerDecisionForm.get('registeredNumber')?.invalid && ministerDecisionForm.get('registeredNumber')?.touched" />
                  @if (ministerDecisionForm.get('registeredNumber')?.invalid && ministerDecisionForm.get('registeredNumber')?.touched) {
                    <span class="error-message">ูุดูุฑ ุจุฑูู ูุทููุจ</span>
                  }
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="mdRegistrationDate">ุชุงุฑูุฎ ุงูุฅุดูุงุฑ <span class="required">*</span></label>
                  <input type="date" id="mdRegistrationDate" formControlName="registrationDate"
                    [class.error]="ministerDecisionForm.get('registrationDate')?.invalid && ministerDecisionForm.get('registrationDate')?.touched" />
                  @if (ministerDecisionForm.get('registrationDate')?.invalid && ministerDecisionForm.get('registrationDate')?.touched) {
                    <span class="error-message">ุชุงุฑูุฎ ุงูุฅุดูุงุฑ ูุทููุจ</span>
                  }
                </div>

                <div class="form-group">
                  <label for="mdArea">ุงููุณุงุญุฉ <span class="required">*</span></label>
                  <input type="number" id="mdArea" formControlName="area"
                    [class.error]="ministerDecisionForm.get('area')?.invalid && ministerDecisionForm.get('area')?.touched" />
                  @if (ministerDecisionForm.get('area')?.invalid && ministerDecisionForm.get('area')?.touched) {
                    <span class="error-message">ุงููุณุงุญุฉ ูุทููุจุฉ</span>
                  }
                </div>
              </div>
            </div>

            <!-- Egyptian Gazette Publication Section -->
            <div class="subsection">
              <h3 class="subsection-title">ุงููุดุฑ ูู ุงูููุงุฆุน ุงููุตุฑูุฉ</h3>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="mdPublicationCount">ุนุฏุฏ ุงููุดุฑ <span class="required">*</span></label>
                  <input type="number" id="mdPublicationCount" formControlName="publicationCount"
                    [class.error]="ministerDecisionForm.get('publicationCount')?.invalid && ministerDecisionForm.get('publicationCount')?.touched" />
                  @if (ministerDecisionForm.get('publicationCount')?.invalid && ministerDecisionForm.get('publicationCount')?.touched) {
                    <span class="error-message">ุนุฏุฏ ุงููุดุฑ ูุทููุจ</span>
                  }
                </div>

                <div class="form-group">
                  <label for="mdPublicationDate">ุชุงุฑูุฎ ุงููุดุฑ <span class="required">*</span></label>
                  <input type="date" id="mdPublicationDate" formControlName="publicationDate"
                    [class.error]="ministerDecisionForm.get('publicationDate')?.invalid && ministerDecisionForm.get('publicationDate')?.touched" />
                  @if (ministerDecisionForm.get('publicationDate')?.invalid && ministerDecisionForm.get('publicationDate')?.touched) {
                    <span class="error-message">ุชุงุฑูุฎ ุงููุดุฑ ูุทููุจ</span>
                  }
                </div>

                <div class="form-group">
                  <label>&nbsp;</label>
                  <button type="submit" class="btn btn-add">+ ุฅุถุงูุฉ</button>
                </div>
              </div>
            </div>
          </form>

          @if (ministerDecisionList().length > 0) {
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>ุฑูู ุงููุฑุงุฑ</th>
                    <th>ุชุงุฑูุฎ ุงููุฑุงุฑ</th>
                    <th>ูุดูุฑ ุจุฑูู</th>
                    <th>ุชุงุฑูุฎ ุงูุฅุดูุงุฑ</th>
                    <th>ุงููุณุงุญุฉ</th>
                    <th>ุนุฏุฏ ุงููุดุฑ</th>
                    <th>ุชุงุฑูุฎ ุงููุดุฑ</th>
                    <th>ุงูุฅุฌุฑุงุกุงุช</th>
                  </tr>
                </thead>
                <tbody>
                  @for (item of ministerDecisionList(); track $index) {
                    <tr>
                      <td>{{ $index + 1 }}</td>
                      <td>{{ item.decisionNumber }}</td>
                      <td>{{ item.decisionDate }}</td>
                      <td>{{ item.registeredNumber }}</td>
                      <td>{{ item.registrationDate }}</td>
                      <td>{{ item.area }}</td>
                      <td>{{ item.publicationCount }}</td>
                      <td>{{ item.publicationDate }}</td>
                      <td>
                        <button type="button" class="btn-delete" (click)="deleteMinisterDecision($index)" title="ุญุฐู">๐๏ธ</button>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          } @else {
            <div class="empty-state"><p>ูุง ุชูุฌุฏ ุจูุงูุงุช. ูู ุจุฅุถุงูุฉ ูุฑุงุฑ ูุฒูุฑ ุฌุฏูุฏ.</p></div>
          }
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-primary" (click)="closeMinisterDecisionModal()">ุญูุธ ูุฅุบูุงู</button>
          <button type="button" class="btn btn-tertiary" (click)="closeMinisterDecisionModal()">ุฅูุบุงุก</button>
        </div>
      </div>
    </div>
  }

  <!-- Sale Forms Modal (ุงุณุชูุงุฑุงุช ุงูุจูุน) -->
  @if (showSaleFormsModal()) {
    <div class="modal-overlay" (click)="closeSaleFormsModal()">
      <div class="modal-content modal-large" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>ุงุณุชูุงุฑุงุช ุงูุจูุน</h2>
          <button class="modal-close" (click)="closeSaleFormsModal()">ร</button>
        </div>

        <div class="modal-body">
          <!-- School Info -->
          <div class="school-info">
            <div class="school-info-item">
              <span class="info-label">ุฑูู ุงููุฏุฑุณุฉ:</span>
              <span class="info-value">{{ schoolNumber() }}</span>
            </div>
            <div class="school-info-item">
              <span class="info-label">ุงุณู ุงููุฏุฑุณุฉ:</span>
              <span class="info-value">{{ schoolName() }}</span>
            </div>
          </div>

          <form [formGroup]="saleFormsForm" (ngSubmit)="submitSaleForms()">
            <div class="form-row">
              <div class="form-group">
                <label for="sfFormType">ููุน ุงูุงุณุชูุงุฑุฉ <span class="required">*</span></label>
                <select id="sfFormType" formControlName="formType"
                  [class.error]="saleFormsForm.get('formType')?.invalid && saleFormsForm.get('formType')?.touched">
                  <option value="" disabled>ุงุฎุชุฑ ููุน ุงูุงุณุชูุงุฑุฉ</option>
                  <option value="real-estate">ุดูุฑ ุนูุงุฑู</option>
                  <option value="civil-registry">ุณุฌู ูุฏูู</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="sfFormNumber">ุฑูู ุงูุงุณุชูุงุฑุฉ <span class="required">*</span></label>
                <input type="text" id="sfFormNumber" formControlName="formNumber"
                  [class.error]="saleFormsForm.get('formNumber')?.invalid && saleFormsForm.get('formNumber')?.touched" />
              </div>

              <div class="form-group">
                <label for="sfOwnerName">ุงุณู ุตุงุญุจ ุงูุดุฃู <span class="required">*</span></label>
                <input type="text" id="sfOwnerName" formControlName="ownerName"
                  [class.error]="saleFormsForm.get('ownerName')?.invalid && saleFormsForm.get('ownerName')?.touched" />
              </div>

              <div class="form-group">
                <label for="sfRegisteredNumber">ูุดูุฑ ุจุฑูู <span class="required">*</span></label>
                <input type="text" id="sfRegisteredNumber" formControlName="registeredNumber"
                  [class.error]="saleFormsForm.get('registeredNumber')?.invalid && saleFormsForm.get('registeredNumber')?.touched" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="sfDate">ุงูุชุงุฑูุฎ <span class="required">*</span></label>
                <input type="date" id="sfDate" formControlName="date"
                  [class.error]="saleFormsForm.get('date')?.invalid && saleFormsForm.get('date')?.touched" />
              </div>

              <div class="form-group">
                <label for="sfArea">ุงููุณุงุญุฉ <span class="required">*</span></label>
                <input type="number" id="sfArea" formControlName="area"
                  [class.error]="saleFormsForm.get('area')?.invalid && saleFormsForm.get('area')?.touched" />
              </div>

              <div class="form-group">
                <label for="sfValue">ุงููููุฉ <span class="required">*</span></label>
                <input type="number" id="sfValue" formControlName="value"
                  [class.error]="saleFormsForm.get('value')?.invalid && saleFormsForm.get('value')?.touched" />
              </div>

              <div class="form-group">
                <label>&nbsp;</label>
                <button type="submit" class="btn btn-add">+ ุฅุถุงูุฉ</button>
              </div>
            </div>
          </form>

          @if (saleFormsList().length > 0) {
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>ููุน ุงูุงุณุชูุงุฑุฉ</th>
                    <th>ุฑูู ุงูุงุณุชูุงุฑุฉ</th>
                    <th>ุงุณู ุตุงุญุจ ุงูุดุฃู</th>
                    <th>ูุดูุฑ ุจุฑูู</th>
                    <th>ุงูุชุงุฑูุฎ</th>
                    <th>ุงููุณุงุญุฉ</th>
                    <th>ุงููููุฉ</th>
                    <th>ุงูุฅุฌุฑุงุกุงุช</th>
                  </tr>
                </thead>
                <tbody>
                  @for (item of saleFormsList(); track $index) {
                    <tr>
                      <td>{{ $index + 1 }}</td>
                      <td>{{ item.formType === 'real-estate' ? 'ุดูุฑ ุนูุงุฑู' : 'ุณุฌู ูุฏูู' }}</td>
                      <td>{{ item.formNumber }}</td>
                      <td>{{ item.ownerName }}</td>
                      <td>{{ item.registeredNumber }}</td>
                      <td>{{ item.date }}</td>
                      <td>{{ item.area }}</td>
                      <td>{{ item.value }}</td>
                      <td>
                        <button type="button" class="btn-delete" (click)="deleteSaleForms($index)" title="ุญุฐู">๐๏ธ</button>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          } @else {
            <div class="empty-state"><p>ูุง ุชูุฌุฏ ุจูุงูุงุช. ูู ุจุฅุถุงูุฉ ุงุณุชูุงุฑุฉ ุจูุน ุฌุฏูุฏุฉ.</p></div>
          }
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-primary" (click)="closeSaleFormsModal()">ุญูุธ ูุฅุบูุงู</button>
          <button type="button" class="btn btn-tertiary" (click)="closeSaleFormsModal()">ุฅูุบุงุก</button>
        </div>
      </div>
    </div>
  }
</div>
